---
layout: post
title:  "Iterative Closest Point"
date:   2018-09-30 15:00:00 -0200
description: ICP.
permalink: /ICP/
---

#### Usage:

  In SLAM systems, the ICP algorithm is usually used in the front-end, i.e. visual odometry, for 3D-3D pose estimation.

#### Problem Setup:

  Given 2 sets of matched 3D points (assuming that we already matched 2 RGB-D images, details refering to the problem known as *data association / point matching / correspondence finding*):

  $$ \boldsymbol{P} = \{\boldsymbol{p}_1, \boldsymbol{p}_2, \dots, \boldsymbol{p}_n\} $$

  $$ \boldsymbol{P}' = \{\boldsymbol{p}'_1, \boldsymbol{p}'_2, \dots, \boldsymbol{p}'_n\} $$

  We would like to find a transformation $$\boldsymbol{R}$$, $$\boldsymbol{t}$$, such that 

  $$ \forall i, \boldsymbol{p}_i = \boldsymbol{R}\boldsymbol{p}'_i + \boldsymbol{t} $$

  ps. inhomogeneous coordinates are used here and below.

#### Solutions:

  Before diving into the solutions, we should notice that camera model (intrinsic and extrinsic parameters of the camera) is not quite relevant when trying to find the transformation between 2 sets of 3D points. 

  In order to find the desired transformation, we first formulate this problem under the leastsquare manner:

  $$ \boldsymbol{R}^*, \boldsymbol{t}^* = \underset{ \boldsymbol{R}, \boldsymbol{t} } {\mathrm{argmin}} \frac{1}{2} \sum_{i=1}^n || \boldsymbol{p}_i - (\boldsymbol{R}\boldsymbol{p}'_i + \boldsymbol{t})  ||^2 $$

  Like any other least square problems, there are 2 methods of finding the optimal transformation: Linear Estimation and Non-Linear Optimization.

  - Linear Estimation

    The most popular linear estimation method is Singular Value Decomposition (SVD). Therefore, some details of SVD are discussed here.

    - SVD

      To Be Added...

    - Reduce the number of parameters

      Optimizing over 2 parameters is more difficult than optimizing over only 1 parameter. Therefore, we first reduce the number parameters in this least square problem.

      By defining the centroids of each set of the points:

      $$ \boldsymbol{p} = \frac{1}{2} \sum_{i=1}^n \boldsymbol{p_i}, \quad \boldsymbol{p}' = \frac{1}{2} \sum_{i=1}^n \boldsymbol{p_i}' $$

      the least square term can now be expressed as:
    
      $$ || \boldsymbol{p_i} - (\boldsymbol{R}\boldsymbol{p_i}' + \boldsymbol{t}) ||^2 = || (\boldsymbol{p_i} - \boldsymbol{p}) + \boldsymbol{p} - \boldsymbol{R}(\boldsymbol{p_i}' - \boldsymbol{p}') - \boldsymbol{R}\boldsymbol{p}' - \boldsymbol{t} ||^2 $$ 

      after expanding and combining terms in the equation, we have:

      $$ || \boldsymbol{p_i} - (\boldsymbol{R}\boldsymbol{p_i}' + \boldsymbol{t}) ||^2 = || \boldsymbol{p_i} - \boldsymbol{p} - \boldsymbol{R}(\boldsymbol{p_i}' - \boldsymbol{p}') ||^2 + || \boldsymbol{p} - \boldsymbol{R}\boldsymbol{p}' - \boldsymbol{t} ||^2 $$

      let

      $$ \boldsymbol{q_i} = \boldsymbol{p_i} - \boldsymbol{p}, \quad \boldsymbol{q_i}' = \boldsymbol{p_i}' - \boldsymbol{p}' $$

      substitute back we have

      $$ \underset{ \boldsymbol{R}, \boldsymbol{t} }{\mathrm{argmin}} \frac{1}{2} \sum_{i=1}^n || \boldsymbol{p_i} - (\boldsymbol{R}\boldsymbol{p_i}' + \boldsymbol{t}) ||^2 = \underset{ \boldsymbol{R} }{\mathrm{argmin}} \frac{1}{2} \sum_{i=1}^n || \boldsymbol{q_i} - \boldsymbol{R}\boldsymbol{q_i}' ||^2 

      + \underset{ \boldsymbol{R}, \boldsymbol{t} }{\mathrm{argmin}} \frac{1}{2} \sum_{i=1}^n || \boldsymbol{p} - \boldsymbol{R}\boldsymbol{p}' - \boldsymbol{t} ||^2 $$





#### Reference:

[1] 高翔；张涛；刘毅；严沁睿: "视觉SLAM十四讲，从理论到实践".

[2] F. Pomerleau, F. Colas, R. Siegwart. "A Review of Point Cloud Registration Algorithms for Mobile Robotics". Foundations and Trends in Robotics. 4 (1): 1–104, 2015.

[3] K. S. Arun, T. S. Huang, and S. D. Blostein. Least-Squares Fitting of Two 3-D Point Sets. Pattern Analysis and Machine Intelligence, IEEE Transactions on, 9(5):698–700, 1987.

[n] S. Rusinkiewicz, M. Levoy. "Efficient Variants of the ICP Algorithm". In Proceedings of the IEEE International Workshop on 3D Digital Imaging and Modeling (3DIM), 2001.

